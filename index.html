<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureChat - E2E Encrypted Messaging</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>

<body data-theme="purple">
    <div class="app-container">

        <!-- Profile Setup Screen -->
        <div class="screen active" id="profileScreen">
            <div class="profile-card">
                <h1>Create Your Profile</h1>
                <p class="subtitle">Set up your identity</p>

                <div class="avatar-upload">
                    <div class="avatar-preview" id="avatarPreview">
                        <span id="avatarInitial">?</span>
                        <img id="avatarImage" style="display: none;">
                    </div>
                    <div class="avatar-upload-options">
                        <button class="icon-btn" id="cameraBtn" title="Take Photo">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 15c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm0-8c2.76 0 5 2.24 5 5s-2.24 5-5 5-5-2.24-5-5 2.24-5 5-5zm0-3l1.3-1.3c.2-.2.5-.2.7 0L16 4.7c.2.2.2.5 0 .7L14.7 6.7c-.2.2-.5.2-.7 0L12 5z" />
                            </svg>
                        </button>
                        <button class="icon-btn" id="uploadBtn" title="Upload Photo">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z" />
                            </svg>
                        </button>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    </div>
                </div>

                <div class="input-group">
                    <label>Your Name</label>
                    <input type="text" id="profileUsername" placeholder="Enter your name" maxlength="20"
                        autocomplete="off">
                </div>

                <div class="input-group">
                    <label>Bio (optional)</label>
                    <textarea id="profileBio" placeholder="Tell something about yourself..." maxlength="150"></textarea>
                    <span class="char-counter" id="bioCounter">0/150</span>
                </div>

                <div class="input-group">
                    <label>Status (optional)</label>
                    <input type="text" id="profileStatus" placeholder="What's on your mind?" maxlength="50"
                        autocomplete="off">
                    <span class="char-counter" id="statusCounter">0/50</span>
                </div>

                <button class="btn-primary" id="profileContinueBtn">
                    Continue to Chat
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" />
                    </svg>
                </button>

                <div class="theme-selector">
                    <label>Choose Theme</label>
                    <div class="theme-options">
                        <button class="theme-option active" data-theme="purple"
                            style="background: linear-gradient(135deg, #7c3aed, #ec4899)"></button>
                        <button class="theme-option" data-theme="blue"
                            style="background: linear-gradient(135deg, #3b82f6, #06b6d4)"></button>
                        <button class="theme-option" data-theme="green"
                            style="background: linear-gradient(135deg, #10b981, #14b8a6)"></button>
                        <button class="theme-option" data-theme="dark"
                            style="background: linear-gradient(135deg, #1e293b, #334155)"></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room Selection Screen -->
        <div class="screen" id="roomScreen">
            <div class="room-card">
                <button class="back-btn" id="backToProfile">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                    </svg>
                </button>

                <h2>Start Chatting</h2>
                <p class="subtitle">Create or join a secure room</p>

                <div class="tabs">
                    <button class="tab active" data-tab="create">Create</button>
                    <button class="tab" data-tab="join">Join</button>
                </div>

                <!-- Create Room Tab -->
                <div class="tab-content active" id="createTab">
                    <div class="room-code-display">
                        <label>Room Code</label>
                        <div class="code-box">
                            <span id="roomCode">------</span>
                            <button class="icon-btn copy-btn" id="copyCodeBtn" title="Copy">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="qr-container">
                        <div id="qrcode"></div>
                    </div>

                    <button class="btn-primary" id="createRoomBtn">
                        Generate Code
                    </button>

                    <div class="waiting-status" id="waitingStatus" style="display: none;">
                        <div class="spinner"></div>
                        <span>Waiting for connection...</span>
                    </div>
                </div>

                <!-- Join Room Tab -->
                <div class="tab-content" id="joinTab">
                    <div class="input-group">
                        <label>Enter Room Code</label>
                        <input type="text" id="roomCodeInput" placeholder="6-digit code" maxlength="6"
                            autocomplete="off">
                    </div>

                    <button class="btn-primary" id="joinRoomBtn">
                        Join Chat
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" />
                        </svg>
                    </button>

                    <div class="divider">
                        <span>OR</span>
                    </div>

                    <button class="btn-secondary" id="scanQrBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M9.5 6.5v3h-3v-3h3M11 5H5v6h6V5zm-1.5 9.5v3h-3v-3h3M11 13H5v6h6v-6zm6.5-6.5v3h-3v-3h3M19 5h-6v6h6V5z" />
                        </svg>
                        Scan QR Code
                    </button>

                    <div id="qrScanner" style="display: none;">
                        <div id="qrReader"></div>
                        <button class="btn-secondary" id="stopScanBtn" style="margin-top: 12px;">Stop Scanning</button>
                    </div>

                    <div class="divider">
                        <span>OR</span>
                    </div>

                    <button class="btn-random" id="randomMatchBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 5-5v3h4v4h-4v3zm6-6h-4V7h4V4l5 5-5 5v-3z" />
                        </svg>
                        Connect Random User
                    </button>

                    <div class="waiting-random" id="waitingRandom" style="display: none;">
                        <div class="spinner"></div>
                        <span>Finding a random stranger...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Screen -->
        <div class="screen" id="chatScreen">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="header-left">
                        <div class="avatar" id="contactAvatar">
                            <span id="contactInitial">?</span>
                            <img id="contactAvatarImg" style="display: none;">
                        </div>
                        <div class="header-info">
                            <h3 id="contactName">Connecting...</h3>
                            <span class="status" id="status">
                                <span class="status-dot"></span>
                                <span id="statusText">Connecting</span>
                            </span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" id="videoCallBtn" title="Video Call" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" />
                            </svg>
                        </button>
                        <button class="icon-btn" id="audioCallBtn" title="Audio Call" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
                            </svg>
                        </button>
                        <button class="icon-btn" id="nextUserBtn" title="Next User" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
                            </svg>
                        </button>
                        <button class="icon-btn" id="viewProfileBtn" title="View Profile">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                            </svg>
                        </button>
                        <span class="room-badge" id="roomCodeBadge">------</span>
                        <button class="icon-btn" id="disconnectBtn" title="Leave">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="date-divider">
                        <span id="chatDate">Today</span>
                    </div>
                </div>

                <div class="chat-input-container">
                    <div class="emoji-picker" id="emojiPicker" style="display: none;">
                        <div class="emoji-grid">
                            ğŸ˜€ ğŸ˜ƒ ğŸ˜„ ğŸ˜ ğŸ˜† ğŸ˜… ğŸ˜‚ ğŸ¤£ ğŸ˜Š ğŸ˜‡ ğŸ™‚ ğŸ™ƒ ğŸ˜‰ ğŸ˜Œ ğŸ˜ ğŸ¥° ğŸ˜˜ ğŸ˜— ğŸ˜™ ğŸ˜š ğŸ˜‹ ğŸ˜› ğŸ˜ ğŸ˜œ ğŸ¤ª ğŸ¤¨ ğŸ§ ğŸ¤“ ğŸ˜ ğŸ¤© ğŸ¥³
                            ğŸ˜ ğŸ˜’ ğŸ˜ ğŸ˜” ğŸ˜Ÿ ğŸ˜• ğŸ™ ğŸ˜£ ğŸ˜– ğŸ˜« ğŸ˜© ğŸ¥º ğŸ˜¢ ğŸ˜­ ğŸ˜¤ ğŸ˜  ğŸ˜¡ ğŸ¤¬ ğŸ¤¯ ğŸ˜³ ğŸ¥µ ğŸ¥¶ ğŸ˜± ğŸ˜¨ ğŸ˜° ğŸ˜¥ ğŸ˜“ ğŸ¤— ğŸ¤” ğŸ¤­ ğŸ¤«
                            ğŸ¤¥ ğŸ˜¶ ğŸ˜ ğŸ˜‘ ğŸ˜¬ ğŸ™„ ğŸ˜¯ ğŸ˜¦ ğŸ˜§ ğŸ˜® ğŸ˜² ğŸ¥± ğŸ˜´ ğŸ¤¤ ğŸ˜ª ğŸ˜µ ğŸ¤ ğŸ¥´ ğŸ¤¢ ğŸ¤® ğŸ¤§ ğŸ˜· ğŸ¤’ ğŸ¤• ğŸ¤‘ ğŸ¤  ğŸ‘ ğŸ‘ ğŸ‘ ğŸ™Œ ğŸ¤
                            ğŸ™ ğŸ’ª â¤ï¸ ğŸ§¡ ğŸ’› ğŸ’š ğŸ’™ ğŸ’œ ğŸ–¤ ğŸ¤ ğŸ¤ ğŸ’” â£ï¸ ğŸ’• ğŸ’ ğŸ’“ ğŸ’— ğŸ’– ğŸ’ ğŸ’Ÿ ğŸ”¥ âœ¨ ğŸ’« â­ ğŸŒŸ âœ… âŒ âš ï¸ ğŸ‰ ğŸŠ ğŸ ğŸˆ
                            ğŸ€ ğŸ‚ ğŸ• ğŸ” ğŸŸ ğŸŒ­ ğŸ¥¤ â˜• ğŸº ğŸ» ğŸ¥‚ ğŸ· ğŸ¾ ğŸ® ğŸ¯ ğŸ² ğŸ¸ ğŸµ ğŸ¶ ğŸ¤ ğŸ§ ğŸ“± ğŸ’» âŒ¨ï¸ ğŸ–±ï¸ ğŸ–¥ï¸
                        </div>
                    </div>
                    <div class="chat-input">
                        <button class="icon-btn emoji-btn" id="emojiBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
                            </svg>
                        </button>
                        <button class="icon-btn file-btn" id="fileBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
                            </svg>
                        </button>
                        <button class="icon-btn voice-btn" id="voiceBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                <path
                                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                            </svg>
                        </button>
                        <div class="input-wrapper">
                            <input type="text" id="messageInput" placeholder="Type a message..." autocomplete="off">
                        </div>
                        <button class="send-btn" id="sendBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                            </svg>
                        </button>
                    </div>
                    <input type="file" id="fileInput" accept="image/*,.pdf,.doc,.docx,.txt" style="display: none;">
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <span id="typingName">Someone</span> is typing
                        <span class="typing-dots">
                            <span></span><span></span><span></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voice Recording Modal -->
        <div class="modal" id="voiceModal" style="display: none;">
            <div class="modal-content">
                <h3>Recording Voice Note</h3>
                <div class="voice-waveform">
                    <div class="waveform-bars">
                        <span></span><span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <div class="voice-timer" id="voiceTimer">00:00</div>
                <div class="voice-controls">
                    <button class="btn-secondary" id="cancelVoiceBtn">Cancel</button>
                    <button class="btn-primary" id="sendVoiceBtn">Send</button>
                </div>
            </div>
        </div>

        <!-- Profile View Modal -->
        <div class="modal" id="profileModal" style="display: none;">
            <div class="modal-content profile-view">
                <button class="close-btn" id="closeProfileBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
                <div class="profile-avatar">
                    <div class="avatar-large" id="modalAvatar">
                        <span id="modalAvatarInitial">?</span>
                        <img id="modalAvatarImg" style="display: none;">
                    </div>
                </div>
                <h2 id="modalName">User</h2>
                <p class="modal-status" id="modalStatus">Hey there!</p>
                <p class="modal-bio" id="modalBio">No bio set</p>
                <div class="modal-info">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                    </svg>
                    <span id="modalLastSeen">Online</span>
                </div>
            </div>
        </div>

        <!-- Privacy Warning -->
        <div class="privacy-warning" id="privacyWarning" style="display: none;">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
            </svg>
            <span>Screenshots detected! Your privacy may be compromised.</span>
        </div>

        <!-- Video Call Modal -->
        <div class="modal" id="videoCallModal" style="display: none;">
            <div class="video-call-container">
                <div class="video-header">
                    <span id="callPartnerName">Stranger</span>
                    <span id="callTimer">00:00</span>
                </div>

                <video id="remoteVideo" autoplay playsinline></video>
                <video id="localVideo" autoplay playsinline muted></video>

                <div class="video-controls">
                    <button class="video-control-btn" id="toggleMicBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                            <path
                                d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                        </svg>
                    </button>
                    <button class="video-control-btn" id="toggleVideoBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" />
                        </svg>
                    </button>
                    <button class="video-control-btn end-call" id="endCallBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Incoming Call Modal -->
        <div class="modal" id="incomingCallModal" style="display: none;">
            <div class="modal-content incoming-call">
                <div class="caller-avatar" id="callerAvatar">
                    <span id="callerInitial">?</span>
                </div>
                <h2 id="callerName">Stranger</h2>
                <p id="callTypeText">Incoming Video Call...</p>

                <div class="call-actions">
                    <button class="call-action-btn reject" id="rejectCallBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" />
                        </svg>
                    </button>
                    <button class="call-action-btn accept" id="acceptCallBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast" style="display: none;"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        Made with â¤ï¸ by <a href="#" target="_blank">Shreyansh</a>
    </div>

    <script src="script.js"></script>
</body>

</html>